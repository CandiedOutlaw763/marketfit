<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MarketFit // AI Opportunity Scanner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="/static/favicon.png">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #e2e8f0;
        }

        .glass {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .gradient-text {
            background: linear-gradient(to right, #38bdf8, #818cf8);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Custom scrollbar for idea cards if needed */
        .idea-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        /* Override browser autofill styles */
        input:-webkit-autofill,
        input:-webkit-autofill:hover,
        input:-webkit-autofill:focus,
        input:-webkit-autofill:active {
            -webkit-box-shadow: 0 0 0 30px rgba(15, 23, 42, 0.5) inset !important;
            -webkit-text-fill-color: #e2e8f0 !important;
            transition: background-color 5000s ease-in-out 0s;
        }
    </style>
</head>

<body
    class="min-h-screen flex flex-col items-center p-6 text-slate-300 selection:bg-blue-500/30 selection:text-blue-200"
    style="background: radial-gradient(circle at 50% 0%, #1e293b 0%, #0f172a 100%);">

    <!-- Background Decor -->
    <div class="fixed inset-0 z-[-1] overflow-hidden pointer-events-none">
        <div class="absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-blue-500/10 rounded-full blur-[100px]"></div>
        <div class="absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-indigo-500/10 rounded-full blur-[100px]">
        </div>
    </div>

    <nav class="w-full max-w-5xl flex justify-between items-center mb-16 mt-4">
        <div class="text-3xl font-extrabold tracking-tight text-white">Market<span class="gradient-text">Fit</span>
        </div>
        <div class="hidden md:flex gap-4">
            <!-- Optional Nav Links could go here -->
        </div>
    </nav>

    <main class="w-full max-w-6xl grid grid-cols-1 lg:grid-cols-12 gap-8">

        <div class="glass rounded-2xl p-8 h-fit lg:col-span-4 space-y-8 border-slate-700/50 shadow-2xl shadow-black/20">
            <h2 class="text-xs uppercase tracking-widest text-slate-500 font-bold mb-6 border-b border-slate-700 pb-2">
                Analysis Configuration</h2>

            <div class="space-y-6">
                <div class="relative group">
                    <label class="block text-[10px] font-bold text-slate-400 mb-1.5 uppercase tracking-wide">Data
                        Source</label>
                    <div class="relative">
                        <div class="relative z-50">
                            <input type="hidden" id="source" value="all">

                            <!-- Trigger -->
                            <button onclick="toggleDropdown()" id="dropdown-trigger"
                                class="w-full bg-slate-900/50 border border-slate-700 rounded-xl p-4 text-sm flex justify-between items-center outline-none transition-all hover:bg-slate-800/50 text-slate-200 font-medium group focus:ring-2 focus:ring-blue-500/50">
                                <span id="selected-source-text" class="truncate">üöÄ All Sources (Deep Scan)</span>
                                <svg class="w-4 h-4 text-slate-500 group-hover:text-blue-400 transition-colors transform group-focus:rotate-180"
                                    fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>

                            <!-- Menu -->
                            <div id="dropdown-menu"
                                class="hidden absolute top-full left-0 right-0 mt-2 bg-slate-900 border border-slate-700 rounded-xl shadow-2xl overflow-hidden transform transition-all origin-top duration-200 max-h-60 overflow-y-auto">
                                <div onclick="selectSource('all', 'üöÄ All Sources (Deep Scan)')"
                                    class="p-3 hover:bg-slate-800 cursor-pointer text-sm text-slate-300 hover:text-white transition-colors border-b border-slate-800/50">
                                    üöÄ All Sources (Deep Scan)</div>
                                <div onclick="selectSource('hn', 'üçä Hacker News Only')"
                                    class="p-3 hover:bg-slate-800 cursor-pointer text-sm text-slate-300 hover:text-white transition-colors border-b border-slate-800/50">
                                    üçä Hacker News Only</div>
                                <div onclick="selectSource('reddit', 'üî¥ Reddit Only')"
                                    class="p-3 hover:bg-slate-800 cursor-pointer text-sm text-slate-300 hover:text-white transition-colors border-b border-slate-800/50">
                                    üî¥ Reddit Only</div>
                                <div onclick="selectSource('reviews', '‚≠ê App Reviews Only')"
                                    class="p-3 hover:bg-slate-800 cursor-pointer text-sm text-slate-300 hover:text-white transition-colors">
                                    ‚≠ê App Reviews Only</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="reddit-input" class="transition-all duration-300">
                    <label class="block text-[10px] font-bold text-slate-400 mb-1.5 uppercase tracking-wide">Target
                        Subreddit</label>
                    <div class="relative">
                        <input type="text" id="subreddits"
                            class="w-full bg-slate-900/50 border border-slate-700 rounded-xl p-4 text-sm focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 outline-none transition-all hover:bg-slate-800/50 placeholder-slate-600 text-slate-200 font-medium"
                            placeholder="e.g. SaaS, startups">
                    </div>
                </div>

                <div id="app-input" class="transition-all duration-300">
                    <label class="block text-[10px] font-bold text-slate-400 mb-1.5 uppercase tracking-wide">Competitor
                        App Name</label>
                    <div class="flex gap-2">
                        <div class="relative flex-grow">
                            <input type="text" id="appName"
                                class="w-full bg-slate-900/50 border border-slate-700 rounded-xl p-4 text-sm focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 outline-none transition-all hover:bg-slate-800/50 placeholder-slate-600 text-slate-200 font-medium"
                                placeholder="Android/iOS App name">
                        </div>
                        <div class="relative w-1/3">
                            <select id="platform"
                                class="w-full h-full bg-slate-900 border border-slate-700 rounded-xl px-3 text-sm focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 outline-none transition-all hover:bg-slate-800 text-slate-200 font-medium appearance-none cursor-pointer">
                                <option value="android" selected>Android</option>
                                <option value="ios">iOS</option>
                            </select>
                            <div
                                class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none text-slate-500">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <button onclick="generateIdeas()" id="generate-btn"
                class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white font-bold py-4 rounded-xl shadow-lg shadow-blue-500/20 transition-all transform active:scale-[0.98] border border-white/10 relative overflow-hidden group">
                <span class="relative z-10 flex justify-center items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                    Generate Opportunities
                </span>
                <div class="absolute inset-0 bg-white/10 opacity-0 group-hover:opacity-100 transition-opacity"></div>
            </button>

            <div id="status"
                class="hidden text-center text-xs text-blue-400 animate-pulse font-mono bg-blue-500/10 py-2 rounded-lg border border-blue-500/20">
                Scanning <span id="source-display">Data Sources</span>... ~15s
            </div>
        </div>

        <div class="lg:col-span-8 space-y-6">

            <div id="empty-state"
                class="glass rounded-2xl p-16 text-center border-dashed border-2 border-slate-700/50 flex flex-col items-center justify-center h-full min-h-[400px]">
                <div class="bg-slate-800/50 p-6 rounded-full mb-6">
                    <svg class="w-16 h-16 text-slate-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                </div>
                <h3 class="text-2xl font-bold text-white mb-3">Uncover Details</h3>
                <p class="text-slate-400 max-w-md mx-auto leading-relaxed">
                    Select your data sources on the left and hit generate. Our AI will analyze user complaints to find
                    gap-in-the-market opportunities.
                </p>
            </div>

            <div id="result-card"
                class="hidden glass rounded-2xl p-8 border-t-[6px] border-blue-500 shadow-2xl shadow-black/30">
                <div class="flex justify-between items-center mb-8 border-b border-slate-700/50 pb-6">
                    <div class="flex items-center gap-3">
                        <div class="bg-blue-500/20 p-2 rounded-lg text-blue-400">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <h2 class="text-2xl font-bold text-white">Analysis Results</h2>
                    </div>
                    <span
                        class="bg-slate-800/80 text-slate-300 text-xs font-mono px-3 py-1.5 rounded-full border border-slate-700">Analyzed
                        <span id="raw-count" class="text-white font-bold">0</span> points</span>
                </div>
                <div id="output-content" class="grid grid-cols-1 gap-6">
                    <!-- Ideas injected here -->
                </div>
            </div>

            <!-- Prompt Modal -->
            <div id="prompt-modal"
                class="fixed inset-0 z-50 flex items-center justify-center hidden bg-black/80 backdrop-blur-sm transition-opacity duration-300">
                <div
                    class="bg-slate-900 border border-slate-700 rounded-xl p-6 w-11/12 max-w-2xl shadow-2xl relative transform transition-all scale-100">
                    <button onclick="closeModal()"
                        class="absolute top-4 right-4 text-slate-400 hover:text-white transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>

                    <h3 class="text-xl font-bold text-white mb-2">Generative Prompt</h3>
                    <p class="text-slate-400 text-sm mb-4">Copy this into your favorite coding assistant (Cursor,
                        Antigravity, etc.)</p>

                    <div class="relative group">
                        <pre id="modal-content"
                            class="bg-slate-950 p-4 rounded-lg border border-slate-800 text-slate-300 font-mono text-sm h-64 overflow-y-auto whitespace-pre-wrap"></pre>
                        <button onclick="copyModalContent()"
                            class="absolute top-2 right-2 bg-blue-600 hover:bg-blue-500 text-white text-xs px-3 py-1.5 rounded transition-colors shadow-lg">
                            Copy to Clipboard
                        </button>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <script>
        // Toggle Inputs based on selection
        function toggleInputs() {
            const source = document.getElementById('source').value;
            const redditInput = document.getElementById('reddit-input');
            const appInput = document.getElementById('app-input');

            if (source === 'all') {
                redditInput.classList.remove('hidden');
                appInput.classList.add('hidden'); // Changed based on user request
            } else if (source === 'hn') {
                redditInput.classList.add('hidden');
                appInput.classList.add('hidden');
            } else if (source === 'reddit') {
                redditInput.classList.remove('hidden');
                appInput.classList.add('hidden');
            } else if (source === 'reviews') {
                redditInput.classList.add('hidden');
                appInput.classList.remove('hidden');
            }
        }

        async function generateIdeas() {
            const btn = document.getElementById('generate-btn');
            const status = document.getElementById('status');
            const emptyState = document.getElementById('empty-state');
            const resultCard = document.getElementById('result-card');
            const outputContent = document.getElementById('output-content');

            const source = document.getElementById('source').value;
            const subredditsVal = document.getElementById('subreddits').value.trim();
            const appNameVal = document.getElementById('appName').value.trim();
            const platformVal = document.getElementById('platform').value;

            // Validation
            if ((source === 'all' || source === 'reddit') && !subredditsVal) {
                alert("Please enter at least one subreddit.");
                return;
            }
            if (source === 'reviews' && !appNameVal) {
                alert("Please enter a competitor app name.");
                return;
            }

            // Lock UI
            btn.disabled = true;
            btn.classList.add('opacity-50', 'cursor-not-allowed');
            status.classList.remove('hidden');
            outputContent.innerHTML = ''; // Clear previous results

            const payload = {
                source: source,
                subreddits: subredditsVal.split(',').map(s => s.trim()),
                app_name: appNameVal,
                platform: platformVal
            };

            try {
                const response = await fetch('/generate-ideas', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'API Error');
                }

                const data = await response.json();

                // Render Results
                document.getElementById('raw-count').innerText = data.raw_count;

                if (data.ideas && data.ideas.length > 0) {
                    data.ideas.forEach((idea, index) => {
                        const ideaHTML = `
                            <div class="idea-card glass p-4 rounded-lg border border-slate-700 hover:border-blue-500 transition-all cursor-pointer group" onclick="showPrompt('${index}')">
                                <div class="flex justify-between items-start mb-2">
                                    <h3 class="text-lg font-bold text-white group-hover:text-blue-400 transition-colors">${idea.name}</h3>
                                    <button class="text-xs bg-slate-800 hover:bg-slate-700 text-slate-300 px-2 py-1 rounded border border-slate-700 pointer-events-none">
                                        View Prompt
                                    </button>
                                </div>
                                <p class="text-slate-300 text-sm mb-3">${idea.pitch}</p>
                                <div class="bg-slate-900/50 p-3 rounded border-l-2 border-slate-600">
                                    <div class="flex justify-between items-center mb-1">
                                        <p class="text-xs text-slate-500 uppercase tracking-widest font-bold">Source Insight</p>
                                        <a href="${idea.source_url}" target="_blank" onclick="event.stopPropagation()" class="text-xs text-blue-400 hover:text-blue-300 flex items-center gap-1 hover:underline">
                                            ${idea.source_origin || 'Source'}
                                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                                        </a>
                                    </div>
                                    <p class="text-xs text-slate-400 italic">"${idea.source_text || 'Aggregated Feedback'}"</p>
                                </div>
                            </div>
                        `;
                        outputContent.innerHTML += ideaHTML;
                    });

                    // Store ideas globally for prompt generation
                    window.generatedIdeas = data.ideas;
                } else {
                    outputContent.innerHTML = '<p class="text-slate-400 text-center">No clear opportunities found. Try a different source.</p>';
                }

                // Update UI
                emptyState.classList.add('hidden');
                resultCard.classList.remove('hidden');

            } catch (err) {
                alert("Generation failed: " + err.message);
                console.error(err);
            } finally {
                // Unlock UI
                btn.disabled = false;
                btn.classList.remove('opacity-50', 'cursor-not-allowed');
                status.classList.add('hidden');
            }
        }

        function showPrompt(index) {
            const idea = window.generatedIdeas[index];
            if (!idea) return;

            const prompt = `Act as a senior software engineer. Based on the following concept, create a full implementation plan and initial code structure.
            
Product Name: ${idea.name}
Pitch: ${idea.pitch}
Core Problem/Insight: "${idea.source_text}"
Source Context: ${idea.source_origin} (${idea.source_url})

Requirements:
1. Create a modern web application using Python (Flask/FastAPI) or Node.js.
2. Focus on solving the core problem identified in the insight.
3. Design a clean, minimal user interface.
`;

            document.getElementById('modal-content').innerText = prompt;
            document.getElementById('prompt-modal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('prompt-modal').classList.add('hidden');
        }

        function copyModalContent() {
            const text = document.getElementById('modal-content').innerText;
            navigator.clipboard.writeText(text).then(() => {
                const btn = document.querySelector('#prompt-modal button.bg-blue-600');
                const originalText = btn.innerText;
                btn.innerText = 'Copied!';
                setTimeout(() => btn.innerText = originalText, 2000);
            });
        }

        // Close modal on escape key
        document.addEventListener('keydown', function (event) {
            if (event.key === "Escape") {
                closeModal();
            }
        });

        // Dropdown Logic
        function toggleDropdown() {
            document.getElementById('dropdown-menu').classList.toggle('hidden');
            document.getElementById('dropdown-trigger').focus();
        }

        function closeDropdown() {
            // Check if mouse is over menu to prevent closing on scroll bar click
            // Simplified for now: just close
            document.getElementById('dropdown-menu').classList.add('hidden');
        }

        function selectSource(value, text) {
            // Update hidden input
            const input = document.getElementById('source');
            input.value = value;

            // Update UI
            document.getElementById('selected-source-text').innerText = text;
            document.getElementById('dropdown-menu').classList.add('hidden');

            // Trigger logic
            toggleInputs();
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function (event) {
            const dropdown = document.getElementById('custom-source-dropdown'); // Parent wrapper needed? 
            // Actually, simply:
            const trigger = document.getElementById('dropdown-trigger');
            const menu = document.getElementById('dropdown-menu');

            if (!trigger.contains(event.target) && !menu.contains(event.target)) {
                menu.classList.add('hidden');
            }
        });

        // Init
        toggleInputs();
    </script>
</body>

</html>